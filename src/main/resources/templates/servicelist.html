<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>

<meta charset="ISO-8859-1">
<title>Service List | Children Care From Team2</title>
<!-- responsive meta -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- For IE -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- master stylesheet -->
<link rel="stylesheet" href="../css/style.css">
<!-- Responsive stylesheet -->
<link rel="stylesheet" href="../css/responsive.css">
<!--Color Switcher Mockup-->
<link rel="stylesheet" href="../css/color-switcher-design.css">
<!--Color Themes-->
<link rel="stylesheet" href="../css/color-themes/default-theme.css"
	id="theme-color-file">
<!-- Bootstrap icons -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<!-- Favicon -->
<link rel="apple-touch-icon" sizes="180x180"
	href="../images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png"
	href="../images/favicon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png"
	href="../images/favicon/favicon-16x16.png" sizes="16x16">
<link rel="stylesheet" href="../css/service-list.css">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
	integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	crossorigin="anonymous">
	    <!-- Fav icon -->	
	<script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
	
<script type="text/javascript">

	function viewServiceDetails(event, service_id) {
		if (event.target.tagName !== "SPAN") { // EXPLANATION : DIV ONCLICK EVENT WILL ALSO BE TRIGGERD WHEN CLICK SPAN INSIDE IT
			window.location = "/ChildrenCare/service/services/" + service_id;
		}
	}

	function addReservationService(event,service_id) {
		var url = "/ChildrenCare/api-reservation/add/"+service_id;
		fetch(url)
				.then(response => response.json())
				.then(data => {
					var shoppingItemsElement = document.querySelector("span#shopping-cart-items");
					var shoppingItems = data.length;
					shoppingItemsElement.innerHTML = shoppingItems;
					//alert(shoppingItems);
					var modalSuccessElement = document.querySelector("#my-modal-success");
					modalSuccessElement.style.display = "block";
					setTimeout(() => {
						modalSuccessElement.style.display = "none";
					},2700)
				})
	}
	
	window.onclick = (event) => {
		var modalSuccessElement = document.querySelector("#my-modal-success");
		if(event.target.id !== "my-modal-success"){
			modalSuccessElement.style.display = "none";
		}
	}

	function changePage(pageNumber) {
		var search = document.querySelector("#search").value;
		var categoryId = parseInt(document.querySelector("#filter").value);
		window.location = "/ChildrenCare/service/services?page=" + pageNumber
				+ "&search=" + search + "&category=" + categoryId;
	}

	function renderPages(totalPages, currentPage) {
		var totalPages = parseInt(document.querySelector("#totalPages").value);
		var currentPage = parseInt(document.querySelector("#currentPage").value);
		var pageListContainer = document.querySelector("#pages");
		var search = document.querySelector("#search").value;
		var categoryId = parseInt(document.querySelector("#filter").value);
		var gap = 2;
		
		
		var prevButton = "";
		
		if(currentPage == 0){
			prevButton = "<span class='glyphicon glyphicon-menu-left pageNumberElement' onclick=changePage(\'"+ (totalPages - 1) +"\')> </span>"
		}else{
			prevButton = "<span class='glyphicon glyphicon-menu-left pageNumberElement' onclick=changePage(\'"+ (currentPage - 1) +"\') > </span>";
		}
		
		pageListContainer.innerHTML += prevButton;
		
		if (currentPage > gap + 1) {
			pageListContainer.innerHTML += "<span class='pageNumberElement' onclick=changePage(\'0\')> 1 </span>"
					+ " <span class='pageNumberElement'> ... </span>"
		} else if (currentPage === gap + 1) {
			pageListContainer.innerHTML += "<span class='pageNumberElement' onclick=changePage(\'0\')> 1 </span>"
		}

		for (let i = 0; i < currentPage; i++) {
			if (i + gap >= currentPage) {
				pageListContainer.innerHTML += "<span class='pageNumberElement' onclick=changePage(\'"
						+ i + "\')> " + (i + 1) + "</span>"
			}
		}
		// Highlight currentpage
		pageListContainer.innerHTML += "<span class='pageNumberElement active' > "
				+ (currentPage + 1) + "</span>"
		//

		for (let i = currentPage + 1; i < totalPages - 1; i++) {
			if (i <= currentPage + gap) {
				pageListContainer.innerHTML += "<span class='pageNumberElement' onclick=changePage(\'"
						+ i + "\')> " + (i + 1) + "</span>"
			}
		}

		if (currentPage + gap + 1 < totalPages - 1) {
			pageListContainer.innerHTML += " <span class='pageNumberElement'> ... </span>"
					+ "<span class='pageNumberElement' onclick=changePage(\'"
					+ (totalPages - 1) + "\')>" + totalPages + "  </span>"
		} else if (currentPage !== totalPages - 1) {
			pageListContainer.innerHTML += "<span class='pageNumberElement' onclick=changePage(\'"
					+ (totalPages - 1) + "\')>" + totalPages + "  </span>"
		}
		
		var nextButton = "";
		
		if(currentPage == (totalPages - 1)){
			nextButton = "<span class='glyphicon glyphicon-menu-right pageNumberElement' onclick=changePage('0')> </span>"
		}else{
			nextButton = "<span class='glyphicon glyphicon-menu-right pageNumberElement' onclick=changePage(\'"+ (currentPage + 1) +"\') > </span>";
		}
		
		pageListContainer.innerHTML += nextButton;
	}
</script>
</head>

<body th:onload="renderPages()">
	<div id="my-modal-success">
		<div class="my-modal-content">
			<h1>Added successfully <i class="fas fa-check" style="font-size : 20px;"></i></h1>
		</div>
	</div>
	<div id="top-bar" th:insert="index :: top-bar"></div>
	<input type="hidden" th:value="${totalPages}" id="totalPages" />
	<div id="form-search" class="container-fluid">
		<form method="POST" action="/ChildrenCare/service/services">
			<input type="hidden" th:value="${currentPage}" id="currentPage" />
			<div class="input-group row">
				<div class="col-sm-6">
					<label class="control-label col-sm-2" for="search"
						style="font-size: 15px;">Search : </label> <input type="text"
						placeholder="Search by title " th:value="${search}"
						class="form-control form-control-sm" id="search" name="search" />
					<div class="input-group-btn">
						<button class="btn btn-success" type="submit">
							<i class="glyphicon glyphicon-search"></i>
						</button>
					</div>
				</div>
				<div class="col-sm-6">
					<label for="filter"
						class="col-sm-3 col-form-label col-form-label-sm"
						style="font-size: 15px;">Category : </label> <select
						class="form-select form-select-sm" id="filter"
						onchange="this.form.submit()" name="category">
						<option value="0">Category</option>
						<option th:each="category : ${categories}"
							th:value="${category.serviceCategoryId}"
							th:text="${category.serviceCategoryName}"
							th:selected="${category.serviceCategoryId} eq ${categoryId}">
						</option>
					</select>
				</div>
			</div>
		</form>
	</div>
	<div id="body" class="container-fluid">
		<div class="row">
			<div class='col-sm-3 service-item' th:each="service : ${services}"
				th:onclick="'viewServiceDetails(event,'+${service.serviceId}+')'">
				<img
					th:src="${'data:image/gif;base64,'+service.base64ThumbnailEncode}"
					class="service-thumbnail" />
				<h1 th:text="${'Title : '+service.title}" class="service-title"></h1>
				<p th:text="${'Brief Info : '+service.briefInfo}"></p>
				<p th:text="'Original price : '+${#numbers.setFormatDecimal(service.originalPrice,1,'POINT',0,'POINT')}"></p>
				<p th:text="'Sale price : '+${#numbers.setFormatDecimal(service.salePrice,1,'POINT',0,'POINT')}"></p>
				<div>
					Rated Stars : <span
						th:class="${service.avg_star >= 1  ? 'fas fa-star rated' : 'fas fa-star'}"></span>
					<span
						th:class="${service.avg_star >= 2  ? 'fas fa-star rated' : 'fas fa-star'}"></span>
					<span
						th:class="${service.avg_star >= 3  ? 'fas fa-star rated' : 'fas fa-star'}"></span>
					<span
						th:class="${service.avg_star >= 4  ? 'fas fa-star rated' : 'fas fa-star'}"></span>
					<span
						th:class="${service.avg_star == 5  ? 'fas fa-star rated' : 'fas fa-star'}"></span>
					<span class="glyphicon glyphicon-shopping-cart"
						 th:onclick="'addReservationService(event,'+${service.serviceId}+')'">
					</span>
					<h5 th:text="'    '+${#numbers.setFormatDecimal(service.avg_star,1,'POINT',1,'POINT')} + ' /5' "></h5>
				</div>
				<h4
					th:text="'Category  :   '+${service.serviceCategory.serviceCategoryName}"></h4>
			</div>
		</div>
	</div>
	<div id="pages"></div>
	<div id="footer" th:insert="index :: footer"></div>
</body>
</html>